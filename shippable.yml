# Language setting http://docs.shippable.com/ci/languages/node/
language: node_js

node_js:
  - 8.2.1

# use this to control what branches get built.
# http://docs.shippable.com/ci/advancedOptions/branches/
branches:
  only:
    - master

build:

  # http://docs.shippable.com/ci/shippableyml/#ci
  ci:
    - sudo npm uninstall npm -g
    - sudo apt-get remove -y nodejs
    - sudo rm -rf /usr/local/{lib/node{,/.npm,_modules},bin,share/man}/npm*
    - sudo rm -rf /usr/lib/node_modules
    - adduser --disabled-password --gecos "" newuser
    - chown -R newuser:newuser $SHIPPABLE_BUILD_DIR
    - chmod +x /root
    - chmod +x /root/src
    - chmod +x /root/src/github.com
    - chmod +x /root/src/github.com/$ORG_NAME
    - ls -al $SHIPPABLE_BUILD_DIR/..
    - sudo apt-get install -y nodejs
    - su -c "whoami" newuser
    - su -c "touch test.txt" newuser
    - su -p -c "cd $SHIPPABLE_BUILD_DIR && npm install" newuser
    - su -c "ls -al $SHIPPABLE_BUILD_DIR" newuser
    

